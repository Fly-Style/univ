<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"> <title>Title</title></head><body><font style = "color:#5B8DDE">using</font>&nbsp;<font style = "color:#CD661D">System</font><font style = "color:#b100d1">;</font>&nbsp;<br><font style = "color:#5B8DDE">using</font>&nbsp;<font style = "color:#CD661D">System</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Collections</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Generic</font><font style = "color:#b100d1">;</font>&nbsp;<br><font style = "color:#5B8DDE">using</font>&nbsp;<font style = "color:#CD661D">System</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">IO</font><font style = "color:#b100d1">;</font>&nbsp;<br><font style = "color:#5B8DDE">using</font>&nbsp;<font style = "color:#CD661D">System</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Threading</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;<br><font style = "color:#5B8DDE">namespace</font>&nbsp;<font style = "color:#CD661D">Fleck</font>&nbsp;<br><font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color = #B5B5B5>///&nbsp;<summary>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color = #B5B5B5>///&nbsp;Wraps&nbsp;a&nbsp;stream&nbsp;and&nbsp;queues&nbsp;multiple&nbsp;write&nbsp;operations.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color = #B5B5B5>///&nbsp;Useful&nbsp;for&nbsp;wrapping&nbsp;SslStream&nbsp;as&nbsp;it&nbsp;does&nbsp;not&nbsp;support&nbsp;multiple&nbsp;simultaneous&nbsp;write&nbsp;operations.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color = #B5B5B5>///&nbsp;</summary>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">class</font>&nbsp;<font style = "color:#CD661D">QueuedStream</font>&nbsp;<font style = "color:#8B4726">:</font>&nbsp;<font style = "color:#CD661D">Stream</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">readonly</font>&nbsp;<font style = "color:#CD661D">Stream</font>&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">readonly</font>&nbsp;<font style = "color:#CD661D">Queue</font><font style = "color:#8B4726"><</font><font style = "color:#CD661D">WriteData</font><font style = "color:#8B4726">></font>&nbsp;<font style = "color:#FF00FF">_queue</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#5B8DDE">new</font>&nbsp;<font style = "color:#CD661D">Queue</font><font style = "color:#8B4726"><</font><font style = "color:#CD661D">WriteData</font><font style = "color:#8B4726">></font><font style = "color:#b100d1">(</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#FF00FF">_pendingWrite</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">bool</font>&nbsp;<font style = "color:#FF00FF">_disposed</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#CD661D">QueuedStream</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">Stream</font>&nbsp;<font style = "color:#CD661D">stream</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">_stream</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#CD661D">stream</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#5B8DDE">bool</font>&nbsp;<font style = "color:#CD661D">CanRead</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">get</font>&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<font style = "color:#5B8DDE">return</font>&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">CanRead</font><font style = "color:#b100d1">;</font>&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#5B8DDE">bool</font>&nbsp;<font style = "color:#CD661D">CanSeek</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">get</font>&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<font style = "color:#5B8DDE">return</font>&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">CanSeek</font><font style = "color:#b100d1">;</font>&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#5B8DDE">bool</font>&nbsp;<font style = "color:#CD661D">CanWrite</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">get</font>&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<font style = "color:#5B8DDE">return</font>&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">CanWrite</font><font style = "color:#b100d1">;</font>&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#5B8DDE">long</font>&nbsp;<font style = "color:#CD661D">Length</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">get</font>&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<font style = "color:#5B8DDE">return</font>&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Length</font><font style = "color:#b100d1">;</font>&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#5B8DDE">long</font>&nbsp;<font style = "color:#CD661D">Position</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">get</font>&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<font style = "color:#5B8DDE">return</font>&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Position</font><font style = "color:#b100d1">;</font>&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">set</font>&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Position</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#CD661D">value</font><font style = "color:#b100d1">;</font>&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">Read</font><font style = "color:#b100d1">(</font><font style = "color:#5B8DDE">byte</font><font style = "color:#b100d1">[</font><font style = "color:#b100d1">]</font>&nbsp;<font style = "color:#CD661D">buffer</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">offset</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">count</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">return</font>&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Read</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">buffer</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">offset</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">count</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#5B8DDE">long</font>&nbsp;<font style = "color:#CD661D">Seek</font><font style = "color:#b100d1">(</font><font style = "color:#5B8DDE">long</font>&nbsp;<font style = "color:#CD661D">offset</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">SeekOrigin</font>&nbsp;<font style = "color:#CD661D">origin</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">return</font>&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Seek</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">offset</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">origin</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#5B8DDE">void</font>&nbsp;<font style = "color:#CD661D">SetLength</font><font style = "color:#b100d1">(</font><font style = "color:#5B8DDE">long</font>&nbsp;<font style = "color:#CD661D">value</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">SetLength</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">value</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#5B8DDE">void</font>&nbsp;<font style = "color:#CD661D">Write</font><font style = "color:#b100d1">(</font><font style = "color:#5B8DDE">byte</font><font style = "color:#b100d1">[</font><font style = "color:#b100d1">]</font>&nbsp;<font style = "color:#CD661D">buffer</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">offset</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">count</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">throw</font>&nbsp;<font style = "color:#5B8DDE">new</font>&nbsp;<font style = "color:#CD661D">NotSupportedException</font><font style = "color:#b100d1">(</font><font color = #FF8C00>"QueuedStream&nbsp;does&nbsp;not&nbsp;support&nbsp;synchronous&nbsp;write&nbsp;operations&nbsp;yet."</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#CD661D">IAsyncResult</font>&nbsp;<font style = "color:#CD661D">BeginRead</font><font style = "color:#b100d1">(</font><font style = "color:#5B8DDE">byte</font><font style = "color:#b100d1">[</font><font style = "color:#b100d1">]</font>&nbsp;<font style = "color:#CD661D">buffer</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">offset</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">count</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">AsyncCallback</font>&nbsp;<font style = "color:#CD661D">callback</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">object</font>&nbsp;<font style = "color:#CD661D">state</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">return</font>&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">BeginRead</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">buffer</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">offset</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">count</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">callback</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">state</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#CD661D">IAsyncResult</font>&nbsp;<font style = "color:#CD661D">BeginWrite</font><font style = "color:#b100d1">(</font><font style = "color:#5B8DDE">byte</font><font style = "color:#b100d1">[</font><font style = "color:#b100d1">]</font>&nbsp;<font style = "color:#CD661D">buffer</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">offset</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">count</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">AsyncCallback</font>&nbsp;<font style = "color:#CD661D">callback</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">object</font>&nbsp;<font style = "color:#CD661D">state</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">lock</font>&nbsp;<font style = "color:#b100d1">(</font><font style = "color:#FF00FF">_queue</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">var</font>&nbsp;<font style = "color:#CD661D">data</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#5B8DDE">new</font>&nbsp;<font style = "color:#CD661D">WriteData</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">buffer</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">offset</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">count</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">callback</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">state</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">if</font>&nbsp;<font style = "color:#b100d1">(</font><font style = "color:#FF00FF">_pendingWrite</font>&nbsp;<font style = "color:#8B4726">></font>&nbsp;<font style = "color:#FFA500">0</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">_queue</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Enqueue</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">data</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">return</font>&nbsp;<font style = "color:#CD661D">data</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">AsyncResult</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">return</font>&nbsp;<font style = "color:#CD661D">BeginWriteInternal</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">buffer</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">offset</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">count</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">callback</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">state</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">data</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">EndRead</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">IAsyncResult</font>&nbsp;<font style = "color:#CD661D">asyncResult</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">return</font>&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">EndRead</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">asyncResult</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#5B8DDE">void</font>&nbsp;<font style = "color:#CD661D">EndWrite</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">IAsyncResult</font>&nbsp;<font style = "color:#CD661D">asyncResult</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">if</font>&nbsp;<font style = "color:#b100d1">(</font><font style = "color:#CD661D">asyncResult</font>&nbsp;<font style = "color:#5B8DDE">is</font>&nbsp;<font style = "color:#CD661D">QueuedWriteResult</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">var</font>&nbsp;<font style = "color:#CD661D">queuedResult</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#CD661D">asyncResult</font>&nbsp;<font style = "color:#5B8DDE">as</font>&nbsp;<font style = "color:#CD661D">QueuedWriteResult</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">if</font>&nbsp;<font style = "color:#b100d1">(</font><font style = "color:#CD661D">queuedResult</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Exception</font>&nbsp;<font style = "color:#8B4726">!</font><font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#5B8DDE">null</font><font style = "color:#b100d1">)</font>&nbsp;<font style = "color:#5B8DDE">throw</font>&nbsp;<font style = "color:#CD661D">queuedResult</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Exception</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">var</font>&nbsp;<font style = "color:#CD661D">ar</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#CD661D">queuedResult</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">ActualResult</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">if</font>&nbsp;<font style = "color:#b100d1">(</font><font style = "color:#CD661D">ar</font>&nbsp;<font style = "color:#8B4726">=</font><font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#5B8DDE">null</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">throw</font>&nbsp;<font style = "color:#5B8DDE">new</font>&nbsp;<font style = "color:#CD661D">NotSupportedException</font><font style = "color:#b100d1">(</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color = #FF8C00>"QueuedStream&nbsp;does&nbsp;not&nbsp;support&nbsp;synchronous&nbsp;write&nbsp;operations.&nbsp;Please&nbsp;wait&nbsp;for&nbsp;callback&nbsp;to&nbsp;be&nbsp;invoked&nbsp;before&nbsp;calling&nbsp;EndWrite."</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color = #B5B5B5>//&nbsp;EndWrite&nbsp;on&nbsp;actual&nbsp;stream&nbsp;should&nbsp;already&nbsp;be&nbsp;invoked.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">else</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">throw</font>&nbsp;<font style = "color:#5B8DDE">new</font>&nbsp;<font style = "color:#CD661D">ArgumentException</font><font style = "color:#b100d1">(</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#5B8DDE">void</font>&nbsp;<font style = "color:#CD661D">Flush</font><font style = "color:#b100d1">(</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Flush</font><font style = "color:#b100d1">(</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#5B8DDE">void</font>&nbsp;<font style = "color:#CD661D">Close</font><font style = "color:#b100d1">(</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Close</font><font style = "color:#b100d1">(</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">protected</font>&nbsp;<font style = "color:#5B8DDE">override</font>&nbsp;<font style = "color:#5B8DDE">void</font>&nbsp;<font style = "color:#CD661D">Dispose</font><font style = "color:#b100d1">(</font><font style = "color:#5B8DDE">bool</font>&nbsp;<font style = "color:#CD661D">disposing</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">if</font>&nbsp;<font style = "color:#b100d1">(</font><font style = "color:#8B4726">!</font><font style = "color:#FF00FF">_disposed</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">if</font>&nbsp;<font style = "color:#b100d1">(</font><font style = "color:#CD661D">disposing</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Dispose</font><font style = "color:#b100d1">(</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">_disposed</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#5B8DDE">true</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">base</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Dispose</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">disposing</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">IAsyncResult</font>&nbsp;<font style = "color:#CD661D">BeginWriteInternal</font><font style = "color:#b100d1">(</font><font style = "color:#5B8DDE">byte</font><font style = "color:#b100d1">[</font><font style = "color:#b100d1">]</font>&nbsp;<font style = "color:#CD661D">buffer</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">offset</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">count</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">AsyncCallback</font>&nbsp;<font style = "color:#CD661D">callback</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">object</font>&nbsp;<font style = "color:#CD661D">state</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">WriteData</font>&nbsp;<font style = "color:#CD661D">queued</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">_pendingWrite</font><font style = "color:#8B4726">+</font><font style = "color:#8B4726">+</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">var</font>&nbsp;<font style = "color:#CD661D">result</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">BeginWrite</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">buffer</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">offset</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">count</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">ar</font>&nbsp;<font style = "color:#8B4726">=</font><font style = "color:#8B4726">></font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color = #B5B5B5>//&nbsp;callback&nbsp;can&nbsp;be&nbsp;executed&nbsp;even&nbsp;before&nbsp;return&nbsp;value&nbsp;of&nbsp;BeginWriteInternal&nbsp;is&nbsp;set&nbsp;to&nbsp;this&nbsp;property&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">queued</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">AsyncResult</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">ActualResult</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#CD661D">ar</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">try</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color = #B5B5B5>//&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;call&nbsp;BeginWrite&nbsp;again&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">_stream</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">EndWrite</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">ar</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">catch</font>&nbsp;<font style = "color:#b100d1">(</font><font style = "color:#CD661D">Exception</font>&nbsp;<font style = "color:#CD661D">exc</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">queued</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">AsyncResult</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Exception</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#CD661D">exc</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color = #B5B5B5>//&nbsp;one&nbsp;down,&nbsp;another&nbsp;is&nbsp;good&nbsp;to&nbsp;go&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">lock</font>&nbsp;<font style = "color:#b100d1">(</font><font style = "color:#FF00FF">_queue</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">_pendingWrite</font><font style = "color:#8B4726">-</font><font style = "color:#8B4726">-</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">while</font>&nbsp;<font style = "color:#b100d1">(</font><font style = "color:#FF00FF">_queue</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Count</font>&nbsp;<font style = "color:#8B4726">></font>&nbsp;<font style = "color:#FFA500">0</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">var</font>&nbsp;<font style = "color:#CD661D">data</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#FF00FF">_queue</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Dequeue</font><font style = "color:#b100d1">(</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">try</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">data</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">AsyncResult</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">ActualResult</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#CD661D">BeginWriteInternal</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">data</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Buffer</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">data</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Offset</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">data</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Count</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">data</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Callback</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">data</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">State</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">data</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">break</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">catch</font>&nbsp;<font style = "color:#b100d1">(</font><font style = "color:#CD661D">Exception</font>&nbsp;<font style = "color:#CD661D">exc</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">_pendingWrite</font><font style = "color:#8B4726">-</font><font style = "color:#8B4726">-</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">data</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">AsyncResult</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Exception</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#CD661D">exc</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">data</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">Callback</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">data</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">AsyncResult</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">callback</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">queued</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">AsyncResult</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">state</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color = #B5B5B5>//&nbsp;always&nbsp;return&nbsp;the&nbsp;wrapped&nbsp;async&nbsp;result.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color = #B5B5B5>//&nbsp;this&nbsp;is&nbsp;especially&nbsp;important&nbsp;if&nbsp;the&nbsp;underlying&nbsp;stream&nbsp;completed&nbsp;the&nbsp;operation&nbsp;synchronously&nbsp;(hence&nbsp;"result.CompletedSynchronously"&nbsp;is&nbsp;true!)&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">queued</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">AsyncResult</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">ActualResult</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#CD661D">result</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">return</font>&nbsp;<font style = "color:#CD661D">queued</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">AsyncResult</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">#region</font>&nbsp;<font style = "color:#CD661D">Nested</font>&nbsp;<font style = "color:#CD661D">type</font><font style = "color:#8B4726">:</font>&nbsp;<font style = "color:#CD661D">WriteData</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">class</font>&nbsp;<font style = "color:#CD661D">WriteData</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">readonly</font>&nbsp;<font style = "color:#5B8DDE">byte</font><font style = "color:#b100d1">[</font><font style = "color:#b100d1">]</font>&nbsp;<font style = "color:#CD661D">Buffer</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">readonly</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">Offset</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">readonly</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">Count</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">readonly</font>&nbsp;<font style = "color:#CD661D">AsyncCallback</font>&nbsp;<font style = "color:#CD661D">Callback</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">readonly</font>&nbsp;<font style = "color:#5B8DDE">object</font>&nbsp;<font style = "color:#CD661D">State</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">readonly</font>&nbsp;<font style = "color:#CD661D">QueuedWriteResult</font>&nbsp;<font style = "color:#CD661D">AsyncResult</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#CD661D">WriteData</font><font style = "color:#b100d1">(</font><font style = "color:#5B8DDE">byte</font><font style = "color:#b100d1">[</font><font style = "color:#b100d1">]</font>&nbsp;<font style = "color:#CD661D">buffer</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">offset</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">int</font>&nbsp;<font style = "color:#CD661D">count</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#CD661D">AsyncCallback</font>&nbsp;<font style = "color:#CD661D">callback</font><font style = "color:#b100d1">,</font>&nbsp;<font style = "color:#5B8DDE">object</font>&nbsp;<font style = "color:#CD661D">state</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">Buffer</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#CD661D">buffer</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">Offset</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#CD661D">offset</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">Count</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#CD661D">count</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">Callback</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#CD661D">callback</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">State</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#CD661D">state</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">AsyncResult</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#5B8DDE">new</font>&nbsp;<font style = "color:#CD661D">QueuedWriteResult</font><font style = "color:#b100d1">(</font><font style = "color:#CD661D">state</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color = #B5B5B5>/*&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">#endregion</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">#region</font>&nbsp;<font style = "color:#CD661D">Nested</font>&nbsp;<font style = "color:#CD661D">type</font><font style = "color:#8B4726">:</font>&nbsp;<font style = "color:#CD661D">QueuedWriteResult</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">class</font>&nbsp;<font style = "color:#CD661D">QueuedWriteResult</font>&nbsp;<font style = "color:#8B4726">:</font>&nbsp;<font style = "color:#CD661D">IAsyncResult</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">readonly</font>&nbsp;<font style = "color:#5B8DDE">object</font>&nbsp;<font style = "color:#FF00FF">_state</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#CD661D">QueuedWriteResult</font><font style = "color:#b100d1">(</font><font style = "color:#5B8DDE">object</font>&nbsp;<font style = "color:#CD661D">state</font><font style = "color:#b100d1">)</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">_state</font>&nbsp;<font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#CD661D">state</font><font style = "color:#b100d1">;</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#CD661D">Exception</font>&nbsp;<font style = "color:#CD661D">Exception</font>&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<font style = "color:#CD661D">get</font><font style = "color:#b100d1">;</font>&nbsp;<font style = "color:#CD661D">set</font><font style = "color:#b100d1">;</font>&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#CD661D">IAsyncResult</font>&nbsp;<font style = "color:#CD661D">ActualResult</font>&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<font style = "color:#CD661D">get</font><font style = "color:#b100d1">;</font>&nbsp;<font style = "color:#CD661D">set</font><font style = "color:#b100d1">;</font>&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">object</font>&nbsp;<font style = "color:#CD661D">AsyncState</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">get</font>&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<font style = "color:#5B8DDE">return</font>&nbsp;<font style = "color:#FF00FF">_state</font><font style = "color:#b100d1">;</font>&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#CD661D">WaitHandle</font>&nbsp;<font style = "color:#CD661D">AsyncWaitHandle</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">get</font>&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<font style = "color:#5B8DDE">throw</font>&nbsp;<font style = "color:#5B8DDE">new</font>&nbsp;<font style = "color:#CD661D">NotSupportedException</font><font style = "color:#b100d1">(</font><font color = #FF8C00>"Queued&nbsp;write&nbsp;operations&nbsp;do&nbsp;not&nbsp;support&nbsp;wait&nbsp;handle."</font><font style = "color:#b100d1">)</font><font style = "color:#b100d1">;</font>&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">bool</font>&nbsp;<font style = "color:#CD661D">CompletedSynchronously</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">get</font>&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<font style = "color:#5B8DDE">return</font>&nbsp;<font style = "color:#5B8DDE">false</font><font style = "color:#b100d1">;</font>&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#5B8DDE">public</font>&nbsp;<font style = "color:#5B8DDE">bool</font>&nbsp;<font style = "color:#CD661D">IsCompleted</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#CD661D">get</font>&nbsp;<font style = "color:#b100d1">{</font>&nbsp;<font style = "color:#5B8DDE">return</font>&nbsp;<font style = "color:#CD661D">ActualResult</font>&nbsp;<font style = "color:#8B4726">!</font><font style = "color:#8B4726">=</font>&nbsp;<font style = "color:#5B8DDE">null</font>&nbsp;<font style = "color:#8B4726">&</font><font style = "color:#8B4726">&</font>&nbsp;<font style = "color:#CD661D">ActualResult</font><font style = "color:#b100d1">.</font><font style = "color:#CD661D">IsCompleted</font><font style = "color:#b100d1">;</font>&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#FF00FF">#endregion</font>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font style = "color:#b100d1">}</font>&nbsp;<br><font style = "color:#b100d1">}</font>&nbsp;<br></body></html>